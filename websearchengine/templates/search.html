<!DOCTYPE html>
{% load static %}
<html>

<head>
    <title>Search Results</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
</head>

<body>

    <nav class="navbar" style="background-color: #e3f2fd;">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                Cyberminer
            </a>
        </div>

    </nav>

    <br>
    <br>
    <div class="inputArea">
        <div class="container-sm">
            <form action="{% url 'search' %}" method="post">
                {% csrf_token %}
                <div class="input-group mb-3 search_bar">
                    <input type="text" name="searchInput" class="form-control" placeholder="Enter keyword"
                        aria-describedby="button-addon1">
                    <button class="btn btn btn-info" type="submit" id="button-addon1">Search</button>
                </div>
            </form>
            <div class="row">
                <div class="col-md-1">
                    <form action="{% url 'search' %}" method="post">
                        {% csrf_token %}
                        <select name="search_type" class="btn btn-outline-info dropdown-toggle heading_class"
                            type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <option value="AND">AND</option>
                            <option value="OR">OR</option>
                            <option value="NOT">NOT</option>
                        </select>
                    </form>
                </div>
                <div class="col-md-6">
                    <form id="sortForm" action="{% url 'sort' %}" method="post">
                        {% csrf_token %}
                        <select id="sortSelect" name="sort_by"
                            class="btn btn-outline-info dropdown-toggle heading_class" onchange="submitForm()">
                            <option value="">Sort By</option>
                            <option value="alphabetical">Alphabetical</option>
                        </select>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="result-stats" style="padding-bottom: 10px; padding-top: 10px; padding-left: 112px;">
        About {{ total_results }} results
    </div>
    <div class="container-md search_container_style">
        <h5 class="search_container_style">Search Results</h5>

        {% if not query_result.empty %}
        {% for _, result in query_result.iterrows %}
        <div class="result">
            <table class="table">
                <h4>{{ result.headlines }}</h4>
                <a href="{{ result.url }}">{{ result.url }}</a>
                <p>{{ result.short_description }}</p>
                <br>
            </table>
        </div>
        {% endfor %}
        {% else %}
        <p>No results found.</p>
        {% endif %}
    </div>

    {% block content %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">

    <script>
        function submitForm() {
            document.getElementById("sortForm").submit();
        }
    </script>
    <script>
        $(document).ready(function () {
            $("#searchInput").select2({
                ajax: {
                    url: "/search/",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            keyword: params.term
                        };
                    },
                    processResults: function (data) {
                        return {
                            results: data
                        };
                    },
                    cache: true
                },
                minimumInputLength: 1
            });
        });
    </script>
    {% endblock %}
</body>

</html>